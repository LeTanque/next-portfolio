{"ast":null,"code":"import _Symbol$iterator from \"@babel/runtime-corejs2/core-js/symbol/iterator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _Array$from from \"@babel/runtime-corejs2/core-js/array/from\";\nimport _getIterator from \"@babel/runtime-corejs2/core-js/get-iterator\";\nimport _Set from \"@babel/runtime-corejs2/core-js/set\";\nimport _Symbol$for from \"@babel/runtime-corejs2/core-js/symbol/for\";\nimport _Symbol from \"@babel/runtime-corejs2/core-js/symbol\";\nimport _construct from \"@babel/runtime-corejs2/helpers/esm/construct\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _toArray from \"@babel/runtime-corejs2/helpers/esm/toArray\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _Object$entries from \"@babel/runtime-corejs2/core-js/object/entries\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _Map from \"@babel/runtime-corejs2/core-js/map\";\nimport _Symbol$toPrimitive from \"@babel/runtime-corejs2/core-js/symbol/to-primitive\";\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, Math as Math$1, PCFSoftShadowMap, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext, memo } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\nvar version = \"3.0.17\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[_Symbol$toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nvar roots = new _Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a);\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return _Array$isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\nvar globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, timestamp) {\n  var repeat = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var runGlobalEffects = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction _invalidate() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  var frames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, {}, objects));\n};\n\nfunction applyProps(instance, newProps) {\n  var oldProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var accumulative = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n\n  var sameProps = _Object$keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n\n  var handlers = _Object$keys(newProps).filter(function (key) {\n    return typeof newProps[key] === 'function' && key.startsWith('on');\n  });\n\n  var leftOvers = accumulative ? _Object$keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var filteredProps = [].concat(_toConsumableArray(sameProps), ['children', 'key', 'ref']).reduce(function (acc, prop) {\n    var rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return filteredProps[key] = undefined;\n  });\n\n  if (_Object$keys(filteredProps).length > 0) {\n    _Object$entries(filteredProps).forEach(function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 2),\n          key = _ref3[0],\n          value = _ref3[1];\n\n      if (!handlers.includes(key)) {\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _entries$reverse2 = _toArray(_entries$reverse),\n                name = _entries$reverse2[0],\n                reverseEntries = _entries$reverse2.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          var _target;\n\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (_Array$isArray(value)) (_target = target).set.apply(_target, _toConsumableArray(value));else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        return _extends({}, acc, _defineProperty({}, key.charAt(2).toLowerCase() + key.substr(3), newProps[key]));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) _invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  var _ref$args = _ref.args,\n      args = _ref$args === void 0 ? [] : _ref$args,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? _construct(target, _toConsumableArray(args)) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [].concat(_toConsumableArray(parentInstance.children.slice(0, index)), [child], _toConsumableArray(parentInstance.children.slice(index)));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent) {\n  var clone = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? _toConsumableArray(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, function () {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n        return x !== child;\n      }); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? _Object$entries(value).some(function (_ref4) {\n          var _ref5 = _slicedToArray(_ref4, 2),\n              key = _ref5[0],\n              val = _ref5[1];\n\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots[\"delete\"](container);\n  });\n}\n\nvar hasSymbol = typeof _Symbol === 'function' && _Symbol$for;\nvar REACT_PORTAL_TYPE = hasSymbol ? _Symbol$for('react.portal') : 0xeaca;\n\nfunction createPortal(children, containerInfo, implementation) {\n  var key = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: false ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = useState(false),\n      ready = _useState[0],\n      setReady = _useState[1];\n\n  var _useState2 = useState(function () {\n    return new Vector2();\n  }),\n      mouse = _useState2[0];\n\n  var _useState3 = useState(function () {\n    var ray = new Raycaster();\n\n    if (raycaster) {\n      var raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _useState3[0];\n\n  var _useState4 = useState(function () {\n    var scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _useState4[0];\n\n  var _useState5 = useState(function () {\n    var cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n      defaultCam = _useState5[0],\n      _setDefaultCamera = _useState5[1];\n\n  var _useState6 = useState(function () {\n    return new Clock();\n  }),\n      clock = _useState6[0]; // Public state\n\n\n  var state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr: vr,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref) {\n      var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate() {\n      return _invalidate(state);\n    },\n    intersect: function intersect(event) {\n      return handlePointerMove(event || {});\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = Math$1.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) _invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = useCallback(function (_ref6) {\n    var clientX = _ref6.clientX,\n        clientY = _ref6.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = useCallback(function (event) {\n    var prepare = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    var seen = new _Set();\n    var hits = []; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = _getIterator(intersects), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var _intersect = _step.value;\n        var eventObject = _intersect.object; // Bubble event up\n\n        while (eventObject) {\n          var handlers = eventObject.__handlers;\n          if (handlers) hits.push(_extends({}, _intersect, {\n            eventObject: eventObject\n          }));\n          eventObject = eventObject.parent;\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n          _iterator[\"return\"]();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = useMemo(function () {\n    return new _Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = useCallback(function (event, fn) {\n    prepareRay(event); // Get fresh intersects\n\n    var hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!hits.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      var unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      var delta = event.type === 'click' ? calculateDistance(event) : 0;\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        var _loop = function _loop() {\n          var hit = _step2.value;\n          var stopped = {\n            current: false\n          };\n\n          var raycastEvent = _extends({}, event, {}, hit, {\n            stopped: stopped,\n            delta: delta,\n            unprojectedPoint: unprojectedPoint,\n            ray: defaultRaycaster.ray,\n            camera: state.current.camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: function stopPropagation() {\n              return stopped.current = true;\n            },\n            sourceEvent: event\n          });\n\n          fn(raycastEvent);\n\n          if (stopped.current === true) {\n            // Propagation is stopped, remove all other hover records\n            // An event handler is only allowed to flush other handlers if it is hovered itself\n            if (hovered.size && _Array$from(hovered.values()).find(function (i) {\n              return i.object === hit.object;\n            })) {\n              handlePointerCancel(raycastEvent, [hit]);\n            }\n\n            return \"break\";\n          }\n        };\n\n        for (var _iterator2 = _getIterator(hits), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _ret = _loop();\n\n          if (_ret === \"break\") break;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n            _iterator2[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n\n    return hits;\n  }, []);\n  var handlePointerMove = useCallback(function (event) {\n    state.current.pointer.emit('pointerMove', event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  var handlePointerCancel = useCallback(function (event, hits) {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n\n    _Array$from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered[\"delete\"](makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = useCallback(function (name) {\n    return function (event) {\n      state.current.pointer.emit(name, event); // Collect hits\n\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click,\n          // which must must the initial target\n          if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if (name === 'click' && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: function onGotPointerCapture(e) {\n        return state.current.captured = intersect(e, false);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = useRef();\n  useMemo(function () {\n    var _state$current = state.current,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadowmap\n\n  useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') _Object$assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var IsReady = useCallback(function () {\n    var activate = function activate() {\n      return setReady(true);\n    };\n\n    useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(function () {\n    render(createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        _invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        state.current.gl.forceContextLoss();\n        state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useFrame(callback) {\n  var renderPriority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = useRef(callback);\n  useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n}\n\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  useEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState7 = useState(false),\n      _ = _useState7[0],\n      forceUpdate = _useState7[1];\n\n  var localRef = useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  useEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\n\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  _Object$keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = _Array$isArray(url) ? url : [url];\n    return _Promise.all(urlArray.map(function (url) {\n      return new _Promise(function (res) {\n        return loader.load(url, function (data) {\n          if (data.scene) {\n            var objects = [];\n            data.scene.traverse(function (props) {\n              return objects.push(prune(props));\n            });\n            data.__$ = objects;\n          }\n\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  useEffect(function () {\n    return function () {\n      return results.forEach(function (data) {\n        if (data.dispose) data.dispose();\n        if (data.scene && data.scene.dispose) data.scene.dispose();\n      });\n    };\n  }, []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  var isArray = _Array$isArray(url);\n\n  if (!isArray) {\n    _Object$assign(results[0], _defineProperty({}, _Symbol$iterator, function () {\n      console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n      return _getIterator([results[0]]);\n    }));\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\n\nfunction useCamera(camera, props) {\n  var _useThree = useThree(),\n      mouse = _useThree.mouse;\n\n  var raycast = useMemo(function () {\n    var raycaster = new Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    var originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }, []);\n  return raycast;\n}\n\nvar IsReady = memo(function (_ref) {\n  var setEvents = _ref.setEvents,\n      canvas = _ref.canvas,\n      gl2 = _ref.gl2,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\", \"gl2\"]);\n\n  var params = _extends({\n    antialias: true,\n    alpha: true\n  }, props.gl);\n\n  var gl = useMemo(function () {\n    return new WebGLRenderer(_extends({\n      canvas: canvas,\n      context: gl2 ? canvas.getContext('webgl2', params) : undefined\n    }, params));\n  }, []); // Init canvas, fetch events, hand them back to the warpping div\n\n  var events = useCanvas(_extends({}, props, {\n    gl: gl\n  }));\n  useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n});\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nvar Canvas = memo(function (props) {\n  var gl2 = props.gl2,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"gl2\", \"shadowMap\", \"orthographic\", \"resize\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  var canvasRef = useRef();\n\n  var _useState8 = useState({}),\n      events = _useState8[0],\n      setEvents = _useState8[1];\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: false || !window.ResizeObserver ? ResizeObserver : undefined\n  }),\n      _useMeasure2 = _slicedToArray(_useMeasure, 2),\n      bind = _useMeasure2[0],\n      size = _useMeasure2[1]; // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n\n  if (false) {\n    return createElement(\"div\", {\n      style: _extends({}, defaultStyles, {}, style)\n    }, createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && createElement(IsReady, _extends({}, props, {\n    size: size,\n    gl2: gl2,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\nexport { Canvas, Renderer, addEffect, applyProps, createPortal, extend, _invalidate as invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useRender, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/Users/tank/git/Portfolio/next-portfolio/node_modules/react-three-fiber/web.js"],"names":["_objectWithoutPropertiesLoose","_extends","THREE","Layers","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","Clock","Vector3","Math","Math$1","PCFSoftShadowMap","WebGLRenderer","Reconciler","unstable_now","unstable_runWithPriority","unstable_IdlePriority","createContext","useState","useRef","useMemo","useCallback","useLayoutEffect","useEffect","createElement","useContext","memo","TinyEmitter","usePromise","useMeasure","ResizeObserver","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","undefined","res","call","TypeError","Number","roots","emptyObject","is","obj","a","Object","str","num","und","arr","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","filter","handlers","startsWith","leftOvers","filteredProps","reduce","acc","prop","rest","map","length","value","includes","target","entries","split","set","reverse","name","reverseEntries","copy","constructor","invalidateInstance","raycast","__handlers","index","__interaction","indexOf","splice","charAt","toLowerCase","substr","parent","updateInstance","update","createInstance","type","_ref","hostContext","internalInstanceHandle","args","props","toUpperCase","slice","object","__instance","has","fn","node","stateNode","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","children","removeRecursive","array","clone","removeChild","remove","x","dispose","switchInstance","fiber","newInstance","alternate","Renderer","now","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","argsNew","restNew","argsOld","restOld","hasNewArgs","some","val","hideInstance","visible","unhideInstance","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","element","get","newRoot","createContainer","updateContainer","getPublicRootInstance","unmountComponentAtNode","hasSymbol","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","useCanvas","orthographic","raycaster","size","pixelRatio","shadowMap","updateDefaultCamera","noEvents","onCreated","onPointerMissed","setReady","mouse","ray","raycasterProps","defaultRaycaster","defaultScene","cam","position","z","defaultCam","_setDefaultCamera","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","captured","events","subscribe","priority","sort","s","setDefaultCamera","intersect","handlePointerMove","distance","distanceTo","fov","degToRad","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","prepareRay","clientX","clientY","setFromCamera","prepare","seen","hits","intersects","intersectObjects","item","id","sharedState","calculateDistance","dx","dy","round","sqrt","hovered","handleIntersects","find","hit","unprojectedPoint","y","unproject","stopped","raycastEvent","stopPropagation","sourceEvent","values","handlePointerCancel","emit","data","pointerMove","pointerOver","pointerEnter","pointerOut","pointerLeave","hoveredItem","handlePointer","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCapture","onLostPointerCapture","_state$current","setPixelRatio","enabled","IsReady","activate","result","then","Provider","setAnimationLoop","t","console","warn","forceContextLoss","useFrame","renderPriority","unsubscribe","useRender","takeOver","useThree","useUpdate","dependents","optionalRef","localRef","useResource","_","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","temp","results","urlArray","all","load","traverse","__$","isArray","useCamera","originalRaycast","prototype","bind","setEvents","canvas","gl2","params","antialias","alpha","context","getContext","defaultStyles","overflow","Canvas","resize","style","restSpread","canvasRef","scroll","debounce","polyfill","window","display"],"mappings":"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","sourcesContent":["import _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport { Layers, Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, Clock, Vector3, Math as Math$1, PCFSoftShadowMap, WebGLRenderer } from 'three';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nimport { createContext, useState, useRef, useMemo, useCallback, useLayoutEffect, useEffect, createElement, useContext, memo } from 'react';\nimport { TinyEmitter } from 'tiny-emitter';\nimport usePromise from 'react-promise-suspense';\nimport useMeasure from 'react-use-measure';\nimport { ResizeObserver } from '@juggle/resize-observer';\n\nvar version = \"3.0.17\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, timestamp, repeat = 0, runGlobalEffects = false) {\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  const delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(sub => sub.ref.current(state.current, delta)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state = true, frames = 2) {\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = _extends({}, catalogue, {}, objects));\nfunction applyProps(instance, newProps, oldProps = {}, accumulative = false) {\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => filteredProps[key] = undefined);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(([key, value]) => {\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const [name, ...reverseEntries] = entries.reverse();\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof Layers)) {\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref, container, hostContext, internalInstanceHandle) {\n  let {\n    args = []\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    const fn = node => {\n      if (!node.return) return node.stateNode && node.stateNode.containerInfo;else return fn(node.return);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone = false) {\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const {\n        args: argsNew = []\n      } = newProps,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const {\n        args: argsOld = []\n      } = oldProps,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(([key, val]) => val !== argsOld[index][key]) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\nconst hasSymbol = typeof Symbol === 'function' && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction createPortal(children, containerInfo, implementation, key = null) {\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nconst stateContext = createContext({});\nconst useCanvas = props => {\n  const {\n    children,\n    gl,\n    camera,\n    orthographic,\n    raycaster,\n    size,\n    pixelRatio,\n    vr = false,\n    shadowMap = false,\n    invalidateFrameloop = false,\n    updateDefaultCamera = true,\n    noEvents = false,\n    onCreated,\n    onPointerMissed\n  } = props; // Local, reactive state\n\n  const [ready, setReady] = useState(false);\n  const [mouse] = useState(() => new Vector2());\n  const [defaultRaycaster] = useState(() => {\n    const ray = new Raycaster();\n\n    if (raycaster) {\n      const raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  });\n  const [defaultScene] = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  });\n  const [defaultCam, _setDefaultCamera] = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  });\n  const [clock] = useState(() => new Clock()); // Public state\n\n  const state = useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr,\n    noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse,\n    clock,\n    gl,\n    size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: (ref, priority = 0) => {\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort((a, b) => a.priority - b.priority);\n      return () => {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(s => s.ref !== ref);\n      };\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useMemo(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  useMemo(() => {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = defaultCam.position.distanceTo(target);\n      const fov = Math$1.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(({\n    clientX,\n    clientY\n  }) => {\n    if (clientX !== void 0) {\n      const {\n        left,\n        right,\n        top,\n        bottom\n      } = state.current.size;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback((event, prepare = true) => {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    let intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (let intersect of intersects) {\n      let eventObject = intersect.object; // Bubble event up\n\n      while (eventObject) {\n        const handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, intersect, {\n          eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  const calculateDistance = useCallback(event => {\n    let dx = event.clientX - state.current.initialClick[0];\n    let dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  const hovered = useMemo(() => new Map(), []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // Get fresh intersects\n\n    const hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(captured => {\n        if (!hits.find(hit => hit.eventObject === captured.eventObject)) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      const unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n      const delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n\n        let raycastEvent = _extends({}, event, {}, hit, {\n          stopped,\n          delta,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true,\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (stopped.current === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(i => i.object === hit.object)) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          break;\n        }\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointerMove = useCallback(event => {\n    state.current.pointer.emit('pointerMove', event);\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(i => i.eventObject === data.eventObject))) {\n        const eventObject = data.eventObject;\n        const handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    state.current.pointer.emit(name, event); // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const eventObject = data.eventObject;\n      const handlers = eventObject.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.eventObject);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      if (calculateDistance(event) <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  useMemo(() => {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: e => handlePointerCancel(e, []),\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: e => state.current.captured = intersect(e, false),\n      onLostPointerCapture: e => (state.current.captured = undefined, handlePointerCancel(e))\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  const sharedState = useRef();\n  useMemo(() => {\n    const _state$current = state.current,\n          props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  useLayoutEffect(() => void (pixelRatio && gl.setPixelRatio(pixelRatio)), [pixelRatio]); // Update shadowmap\n\n  useLayoutEffect(() => {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = () => setReady(true);\n\n    useEffect(() => {\n      const result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    render(createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  useLayoutEffect(() => {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(t => renderGl(state, t, 0, true));\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  useEffect(() => () => {\n    if (state.current.gl) {\n      state.current.gl.forceContextLoss();\n      state.current.gl.dispose();\n      state.current.gl = undefined;\n      unmountComponentAtNode(state.current.scene);\n      state.current.active = false;\n    }\n  }, []);\n  return state.current.events;\n};\n\nfunction useFrame(callback, renderPriority = 0) {\n  const {\n    subscribe\n  } = useContext(stateContext); // Update ref\n\n  const ref = useRef(callback);\n  useLayoutEffect(() => void (ref.current = callback), [callback]); // Subscribe/unsub\n\n  useEffect(() => {\n    const unsubscribe = subscribe(ref, renderPriority);\n    return () => unsubscribe();\n  }, [renderPriority]);\n}\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const {\n    invalidate\n  } = useContext(stateContext);\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const [_, forceUpdate] = useState(false);\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => void forceUpdate(i => !i), [ref.current]);\n  return [ref, ref.current];\n}\nconst blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  const reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(name => delete reducedProps[name]); // Remove functions\n\n  Object.keys(reducedProps).forEach(name => typeof reducedProps[name] === 'function' && delete reducedProps[name]); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  const loader = useMemo(() => {\n    // Construct new loader\n    const temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  const results = usePromise((Proto, url) => {\n    const urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(url => new Promise(res => loader.load(url, data => {\n      if (data.scene) {\n        const objects = [];\n        data.scene.traverse(props => objects.push(prune(props)));\n        data.__$ = objects;\n      }\n\n      res(data);\n    }))));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  useEffect(() => () => results.forEach(data => {\n    if (data.dispose) data.dispose();\n    if (data.scene && data.scene.dispose) data.scene.dispose();\n  }), []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  const isArray = Array.isArray(url);\n\n  if (!isArray) {\n    Object.assign(results[0], {\n      [Symbol.iterator]() {\n        console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n        return [results[0]][Symbol.iterator]();\n      }\n\n    });\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\nfunction useCamera(camera, props) {\n  const {\n    mouse\n  } = useThree();\n  const raycast = useMemo(() => {\n    let raycaster = new Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    let originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }, []);\n  return raycast;\n}\n\nconst IsReady = memo((_ref) => {\n  let {\n    setEvents,\n    canvas,\n    gl2\n  } = _ref,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\", \"gl2\"]);\n\n  const params = _extends({\n    antialias: true,\n    alpha: true\n  }, props.gl);\n\n  const gl = useMemo(() => new WebGLRenderer(_extends({\n    canvas,\n    context: gl2 ? canvas.getContext('webgl2', params) : undefined\n  }, params)), []); // Init canvas, fetch events, hand them back to the warpping div\n\n  const events = useCanvas(_extends({}, props, {\n    gl\n  }));\n  useEffect(() => void setEvents(events), [events]);\n  return null;\n});\nconst defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nconst Canvas = memo(props => {\n  const {\n    gl2,\n    resize,\n    style\n  } = props,\n        restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"gl2\", \"shadowMap\", \"orthographic\", \"resize\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  const canvasRef = useRef();\n  const [events, setEvents] = useState({});\n  const [bind, size] = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? ResizeObserver : undefined\n  }); // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') {\n    return createElement(\"div\", {\n      style: _extends({}, defaultStyles, {}, style)\n    }, createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && createElement(IsReady, _extends({}, props, {\n    size: size,\n    gl2: gl2,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\n\nexport { Canvas, Renderer, addEffect, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, renderGl, stateContext, unmountComponentAtNode, useCamera, useCanvas, useFrame, useLoader, useRender, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}