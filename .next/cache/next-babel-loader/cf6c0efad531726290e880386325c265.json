{"ast":null,"code":"'use strict';\n\nvar _Symbol$iterator = require(\"@babel/runtime-corejs2/core-js/symbol/iterator\");\n\nvar _Promise = require(\"@babel/runtime-corejs2/core-js/promise\");\n\nvar _Object$assign2 = require(\"@babel/runtime-corejs2/core-js/object/assign\");\n\nvar _Array$from = require(\"@babel/runtime-corejs2/core-js/array/from\");\n\nvar _getIterator = require(\"@babel/runtime-corejs2/core-js/get-iterator\");\n\nvar _Set = require(\"@babel/runtime-corejs2/core-js/set\");\n\nvar _Symbol$for = require(\"@babel/runtime-corejs2/core-js/symbol/for\");\n\nvar _Symbol = require(\"@babel/runtime-corejs2/core-js/symbol\");\n\nvar _Object$entries = require(\"@babel/runtime-corejs2/core-js/object/entries\");\n\nvar _Object$keys = require(\"@babel/runtime-corejs2/core-js/object/keys\");\n\nvar _Array$isArray = require(\"@babel/runtime-corejs2/core-js/array/is-array\");\n\nvar _Map = require(\"@babel/runtime-corejs2/core-js/map\");\n\nvar _Symbol$toPrimitive = require(\"@babel/runtime-corejs2/core-js/symbol/to-primitive\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\n_Object$defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar _extends = _interopDefault(require('@babel/runtime/helpers/extends'));\n\nvar _objectWithoutPropertiesLoose = _interopDefault(require('@babel/runtime/helpers/objectWithoutPropertiesLoose'));\n\nvar _construct = _interopDefault(require('@babel/runtime/helpers/construct'));\n\nvar THREE = require('three');\n\nvar Reconciler = _interopDefault(require('react-reconciler'));\n\nvar scheduler = require('scheduler');\n\nvar React = require('react');\n\nvar React__default = _interopDefault(React);\n\nvar tinyEmitter = require('tiny-emitter');\n\nvar usePromise = _interopDefault(require('react-promise-suspense'));\n\nvar ReactDOM = _interopDefault(require('react-dom'));\n\nvar useMeasure = _interopDefault(require('react-use-measure'));\n\nvar resizeObserver = require('@juggle/resize-observer');\n\nvar mergeRefs = _interopDefault(require('react-merge-refs'));\n\nvar version = \"4.0.0-beta.14\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[_Symbol$toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nvar roots = new _Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a);\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return _Array$isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\nvar globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  } // Run global effects\n\n\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, {}, objects));\n};\n\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  } // Filter equals, events and reserved props\n\n\n  var container = instance.__container;\n\n  var sameProps = _Object$keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n\n  var handlers = _Object$keys(newProps).filter(function (key) {\n    return typeof newProps[key] === 'function' && key.startsWith('on');\n  });\n\n  var leftOvers = accumulative ? _Object$keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var filteredProps = [].concat(sameProps, ['children', 'key', 'ref']).reduce(function (acc, prop) {\n    var _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return filteredProps[key] = undefined;\n  });\n\n  if (_Object$keys(filteredProps).length > 0) {\n    _Object$entries(filteredProps).forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          var _target;\n\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (_Array$isArray(value)) (_target = target).set.apply(_target, value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        var _extends2;\n\n        return _extends({}, acc, (_extends2 = {}, _extends2[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key], _extends2));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? _construct(target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [].concat(parentInstance.children.slice(0, index), [child], parentInstance.children.slice(index));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n          return x !== child;\n        }); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? _Object$entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\nvar LegacyRoot = 0;\nvar ConcurrentRoot = 2;\nvar hasSymbol = typeof _Symbol === 'function' && _Symbol$for;\nvar REACT_PORTAL_TYPE = hasSymbol ? _Symbol$for('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots[\"delete\"](container);\n  });\n}\n\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: false ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = React.createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = React.useState(false),\n      ready = _useState[0],\n      setReady = _useState[1];\n\n  var _useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _useState2[0];\n\n  var _useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _useState3[0];\n\n  var _useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _useState4[0];\n\n  var _useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n      defaultCam = _useState5[0],\n      _setDefaultCamera = _useState5[1];\n\n  var _useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      } // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n\n\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event) {\n      return handlePointerMove(event || {});\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new THREE.Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = THREE.Math.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (_ref) {\n    var clientX = _ref.clientX,\n        clientY = _ref.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    } // Skip event handling when noEvents is set\n\n\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    var seen = new _Set();\n    var hits = []; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (var _iterator = intersects, _isArray = _Array$isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _getIterator(_iterator);;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var _intersect = _ref2;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = React.useMemo(function () {\n    return new _Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (event, fn) {\n    prepareRay(event); // Get fresh intersects\n\n    var hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!hits.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      var unprojectedPoint = new THREE.Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      var _delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      var _loop = function _loop() {\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) return \"break\";\n          _ref3 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) return \"break\";\n          _ref3 = _i2.value;\n        }\n\n        var hit = _ref3;\n        var stopped = {\n          current: false\n        };\n\n        var raycastEvent = _extends({}, event, {}, hit, {\n          stopped: stopped,\n          delta: _delta,\n          unprojectedPoint: unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: function stopPropagation() {\n            return stopped.current = true;\n          },\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (stopped.current === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && _Array$from(hovered.values()).find(function (i) {\n            return i.object === hit.object;\n          })) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          return \"break\";\n        }\n      };\n\n      for (var _iterator2 = hits, _isArray2 = _Array$isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _getIterator(_iterator2);;) {\n        var _ref3;\n\n        var _ret = _loop();\n\n        if (_ret === \"break\") break;\n      }\n    }\n\n    return hits;\n  }, []);\n  var handlePointerMove = React.useCallback(function (event) {\n    state.current.pointer.emit('pointerMove', event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits) {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n\n    _Array$from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered[\"delete\"](makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event) {\n      state.current.pointer.emit(name, event); // Collect hits\n\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click,\n          // which must must the initial target\n          if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if (name === 'click' && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: function onGotPointerCapture(e) {\n        return state.current.captured = intersect(e, false);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef();\n  React.useMemo(function () {\n    var _state$current = state.current,\n        ready = _state$current.ready,\n        manual = _state$current.manual,\n        vr = _state$current.vr,\n        noEvents = _state$current.noEvents,\n        invalidateFrameloop = _state$current.invalidateFrameloop,\n        frames = _state$current.frames,\n        subscribers = _state$current.subscribers,\n        captured = _state$current.captured,\n        initialClick = _state$current.initialClick,\n        initialHits = _state$current.initialHits,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadowmap\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') _Object$assign2(gl, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var IsReady = React.useCallback(function () {\n    var activate = function activate() {\n      return setReady(true);\n    }; // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render(React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, React.createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        if (state.current.gl.dispose) state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  var result = React.useContext(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\n\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  _Object$keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = React.useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = _Array$isArray(url) ? url : [url];\n    return _Promise.all(urlArray.map(function (url) {\n      return new _Promise(function (res) {\n        return loader.load(url, function (data) {\n          var objects = [];\n          if (data.scene) data.scene.traverse(function (props) {\n            return objects.push(prune(props));\n          });\n          data.__$ = objects;\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  React.useEffect(function () {\n    return function () {\n      return results.forEach(function (data) {\n        if (data.dispose) data.dispose();\n        if (data.scene && data.scene.dispose) data.scene.dispose();\n      });\n    };\n  }, []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  var isArray = _Array$isArray(url);\n\n  if (!isArray) {\n    var _Object$assign;\n\n    _Object$assign2(results[0], (_Object$assign = {}, _Object$assign[_Symbol$iterator] = function () {\n      console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n      return _getIterator([results[0]]);\n    }, _Object$assign));\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\n\nfunction useCamera(camera, props) {\n  var _useThree = useThree(),\n      mouse = _useThree.mouse;\n\n  var _useState2 = React.useState(function () {\n    var raycaster = new THREE.Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    var originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }),\n      raycast = _useState2[0];\n\n  return raycast;\n}\n\nvar vector = new THREE.Vector3();\n\nfunction calculatePosition(el, camera, viewport) {\n  vector.setFromMatrixPosition(el.matrixWorld);\n  vector.project(camera);\n  return [(vector.x + 1) * viewport.width / 2, (-vector.y + 1) * viewport.height / 2];\n}\n\nvar Dom = React__default.forwardRef(function (_ref, ref) {\n  var children = _ref.children,\n      _ref$eps = _ref.eps,\n      eps = _ref$eps === void 0 ? 0.001 : _ref$eps,\n      style = _ref.style,\n      className = _ref.className,\n      prepend = _ref.prepend,\n      center = _ref.center,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"eps\", \"style\", \"className\", \"prepend\", \"center\"]);\n\n  var _useThree = useThree(),\n      gl = _useThree.gl,\n      scene = _useThree.scene,\n      camera = _useThree.camera,\n      viewport = _useThree.viewport;\n\n  var _useState = React.useState(function () {\n    return document.createElement('div');\n  }),\n      el = _useState[0];\n\n  var group = React.useRef(null);\n  var old = React.useRef([0, 0]);\n  React.useEffect(function () {\n    if (group.current) {\n      scene.updateMatrixWorld();\n      var vec = calculatePosition(group.current, camera, viewport);\n      el.style.cssText = \"position:absolute;top:0;left:0;transform:translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0);\";\n\n      if (gl.domElement.parentNode) {\n        if (prepend) gl.domElement.parentNode.prepend(el);else gl.domElement.parentNode.appendChild(el);\n      }\n\n      return function () {\n        if (gl.domElement.parentNode) gl.domElement.parentNode.removeChild(el);\n        ReactDOM.unmountComponentAtNode(el);\n      };\n    }\n  }, []);\n  React.useEffect(function () {\n    return void ReactDOM.render(React__default.createElement(\"div\", {\n      style: _extends({\n        transform: center ? 'translate3d(-50%,-50%,0)' : 'none'\n      }, style),\n      className: className,\n      ref: ref\n    }, children), el);\n  });\n  useFrame(function () {\n    if (group.current) {\n      var vec = calculatePosition(group.current, camera, viewport);\n\n      if (Math.abs(old.current[0] - vec[0]) > eps || Math.abs(old.current[1] - vec[1]) > eps) {\n        el.style.transform = \"translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0)\";\n      }\n\n      old.current = vec;\n    }\n  });\n  return React__default.createElement(\"group\", _extends({}, props, {\n    ref: group\n  }));\n});\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  var children = _ref.children,\n      setEvents = _ref.setEvents,\n      container = _ref.container,\n      renderer = _ref.renderer,\n      effects = _ref.effects,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]); // Create renderer\n\n\n  var _useState = React.useState(renderer),\n      gl = _useState[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  React.useEffect(function () {\n    return effects && effects(gl, container);\n  }, []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_extends({}, props, {\n    children: children,\n    gl: gl\n  }));\n  React.useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n}\n\nvar ResizeContainer = React__default.memo(function (props) {\n  var renderer = props.renderer,\n      effects = props.effects,\n      children = props.children,\n      vr = props.vr,\n      gl2 = props.gl2,\n      concurrent = props.concurrent,\n      shadowMap = props.shadowMap,\n      orthographic = props.orthographic,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  var containerRef = React.useRef();\n\n  var _useState2 = React.useState({}),\n      events = _useState2[0],\n      setEvents = _useState2[1];\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: true || !window.ResizeObserver ? resizeObserver.ResizeObserver : undefined\n  }),\n      bind = _useMeasure[0],\n      size = _useMeasure[1]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = React.useRef(false);\n  var ready = React.useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = React.useMemo(function () {\n    return {\n      size: size,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (true) return React__default.createElement(\"div\", _extends({\n    style: _extends({}, defaultStyles, {}, style)\n  }, restSpread)); // Render the canvas into the dom\n\n  return React__default.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), preRender, ready && React__default.createElement(Content, _extends({}, props, state)));\n});\nvar Canvas = React__default.memo(function (_ref) {\n  var children = _ref.children,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  var canvasRef = React.useRef();\n  return React__default.createElement(ResizeContainer, _extends({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _extends({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new THREE.WebGLRenderer(_extends({\n          canvas: canvasRef.current,\n          context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n        }, params));\n        return temp;\n      }\n    },\n    preRender: React__default.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\nexports.Canvas = Canvas;\nexports.Dom = Dom;\nexports.Renderer = Renderer;\nexports.addEffect = addEffect;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCamera = useCamera;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useLoader = useLoader;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;","map":{"version":3,"sources":["/Users/tank/git/Portfolio/next-portfolio/node_modules/react-three-fiber/web.cjs.js"],"names":["exports","value","_interopDefault","ex","_extends","require","_objectWithoutPropertiesLoose","_construct","THREE","Reconciler","scheduler","React","React__default","tinyEmitter","usePromise","ReactDOM","useMeasure","resizeObserver","mergeRefs","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","undefined","res","call","TypeError","Number","roots","emptyObject","is","obj","a","Object","str","num","und","arr","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","filter","handlers","startsWith","leftOvers","filteredProps","concat","reduce","acc","prop","_","rest","map","length","_ref","includes","target","entries","split","set","_entries$reverse","reverse","_name","reverseEntries","slice","copy","Layers","_target","constructor","name","apply","invalidateInstance","raycast","__handlers","index","__interaction","indexOf","splice","_extends2","charAt","toLowerCase","substr","parent","updateInstance","update","createInstance","type","_ref2","hostContext","internalInstanceHandle","_ref2$args","args","props","toUpperCase","object","__instance","has","fn","node","stateNode","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","children","removeRecursive","array","clone","removeChild","remove","x","dispose","unstable_runWithPriority","unstable_IdlePriority","switchInstance","fiber","newInstance","alternate","Renderer","now","unstable_now","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","hasNewArgs","some","_ref3","val","hideInstance","visible","unhideInstance","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","LegacyRoot","ConcurrentRoot","hasSymbol","REACT_PORTAL_TYPE","element","get","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","createContext","useCanvas","orthographic","raycaster","size","pixelRatio","_props$vr","_props$concurrent","_props$shadowMap","shadowMap","_props$invalidateFram","_props$updateDefaultC","updateDefaultCamera","_props$noEvents","noEvents","onCreated","onPointerMissed","_useState","useState","setReady","_useState2","Vector2","mouse","_useState3","ray","Raycaster","raycasterProps","defaultRaycaster","_useState4","Scene","defaultScene","_useState5","cam","OrthographicCamera","PerspectiveCamera","position","z","defaultCam","_setDefaultCamera","_useState6","Clock","useRef","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","TinyEmitter","captured","events","subscribe","priority","sort","s","setDefaultCamera","invalidate$1","intersect","handlePointerMove","useMemo","Vector3","distance","distanceTo","fov","degToRad","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","prepareRay","useCallback","clientX","clientY","_state$current$size","setFromCamera","prepare","seen","hits","intersects","intersectObjects","item","id","sharedState","_iterator","_isArray","_i","next","done","_intersect","calculateDistance","dx","dy","round","sqrt","hovered","handleIntersects","find","hit","unprojectedPoint","y","unproject","_delta","_loop","_isArray2","_i2","_iterator2","stopped","raycastEvent","stopPropagation","sourceEvent","values","handlePointerCancel","_ret","emit","data","pointerMove","pointerOver","pointerEnter","pointerOut","pointerLeave","hoveredItem","handlePointer","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCapture","onLostPointerCapture","_state$current","useLayoutEffect","setPixelRatio","enabled","PCFSoftShadowMap","IsReady","activate","useEffect","result","then","createElement","Provider","setAnimationLoop","t","console","warn","forceContextLoss","useContext","context","useFrame","renderPriority","_useContext","unsubscribe","useThree","useUpdate","dependents","optionalRef","_useContext2","localRef","useResource","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","temp","results","urlArray","all","load","traverse","__$","isArray","_Object$assign","useCamera","_useThree","originalRaycast","prototype","bind","vector","calculatePosition","el","setFromMatrixPosition","matrixWorld","project","Dom","forwardRef","_ref$eps","eps","style","className","prepend","center","document","group","old","vec","cssText","domElement","parentNode","transform","abs","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","gl2","preRender","resize","restSpread","containerRef","_useMeasure","scroll","debounce","polyfill","window","ResizeObserver","readyFlag","Canvas","canvasRef","params","antialias","alpha","WebGLRenderer","canvas","getContext","display"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar _extends = _interopDefault(require('@babel/runtime/helpers/extends'));\nvar _objectWithoutPropertiesLoose = _interopDefault(require('@babel/runtime/helpers/objectWithoutPropertiesLoose'));\nvar _construct = _interopDefault(require('@babel/runtime/helpers/construct'));\nvar THREE = require('three');\nvar Reconciler = _interopDefault(require('react-reconciler'));\nvar scheduler = require('scheduler');\nvar React = require('react');\nvar React__default = _interopDefault(React);\nvar tinyEmitter = require('tiny-emitter');\nvar usePromise = _interopDefault(require('react-promise-suspense'));\nvar ReactDOM = _interopDefault(require('react-dom'));\nvar useMeasure = _interopDefault(require('react-use-measure'));\nvar resizeObserver = require('@juggle/resize-observer');\nvar mergeRefs = _interopDefault(require('react-merge-refs'));\n\nvar version = \"4.0.0-beta.14\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a);\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\nvar globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nvar catalogue = {};\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, {}, objects));\n};\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  }\n\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n  var sameProps = Object.keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n  var handlers = Object.keys(newProps).filter(function (key) {\n    return typeof newProps[key] === 'function' && key.startsWith('on');\n  });\n  var leftOvers = accumulative ? Object.keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var filteredProps = [].concat(sameProps, ['children', 'key', 'ref']).reduce(function (acc, prop) {\n    var _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return filteredProps[key] = undefined;\n  });\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          var _target;\n\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) (_target = target).set.apply(_target, value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        var _extends2;\n\n        return _extends({}, acc, (_extends2 = {}, _extends2[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key], _extends2));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? _construct(target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [].concat(parentInstance.children.slice(0, index), [child], parentInstance.children.slice(index));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n        // Remove interactivity\n        if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n          return x !== child;\n        }); // Remove nested child objects\n\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose) child.dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\nvar LegacyRoot = 0;\nvar ConcurrentRoot = 2;\nvar hasSymbol = typeof Symbol === 'function' && Symbol[\"for\"];\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol[\"for\"]('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? ConcurrentRoot : LegacyRoot, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots[\"delete\"](container);\n  });\n}\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = React.createContext({});\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = React.useState(false),\n      ready = _useState[0],\n      setReady = _useState[1];\n\n  var _useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _useState2[0];\n\n  var _useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _useState3[0];\n\n  var _useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _useState4[0];\n\n  var _useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n      defaultCam = _useState5[0],\n      _setDefaultCamera = _useState5[1];\n\n  var _useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      }\n\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event) {\n      return handlePointerMove(event || {});\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new THREE.Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = THREE.Math.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (_ref) {\n    var clientX = _ref.clientX,\n        clientY = _ref.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    var seen = new Set();\n    var hits = []; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (var _iterator = intersects, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var _intersect = _ref2;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = React.useMemo(function () {\n    return new Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (event, fn) {\n    prepareRay(event); // Get fresh intersects\n\n    var hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!hits.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      var unprojectedPoint = new THREE.Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      var _delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      var _loop = function _loop() {\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) return \"break\";\n          _ref3 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) return \"break\";\n          _ref3 = _i2.value;\n        }\n\n        var hit = _ref3;\n        var stopped = {\n          current: false\n        };\n\n        var raycastEvent = _extends({}, event, {}, hit, {\n          stopped: stopped,\n          delta: _delta,\n          unprojectedPoint: unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: function stopPropagation() {\n            return stopped.current = true;\n          },\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (stopped.current === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(function (i) {\n            return i.object === hit.object;\n          })) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          return \"break\";\n        }\n      };\n\n      for (var _iterator2 = hits, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n        var _ref3;\n\n        var _ret = _loop();\n\n        if (_ret === \"break\") break;\n      }\n    }\n\n    return hits;\n  }, []);\n  var handlePointerMove = React.useCallback(function (event) {\n    state.current.pointer.emit('pointerMove', event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits) {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n    Array.from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered[\"delete\"](makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event) {\n      state.current.pointer.emit(name, event); // Collect hits\n\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click,\n          // which must must the initial target\n          if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if (name === 'click' && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: function onGotPointerCapture(e) {\n        return state.current.captured = intersect(e, false);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef();\n  React.useMemo(function () {\n    var _state$current = state.current,\n        ready = _state$current.ready,\n        manual = _state$current.manual,\n        vr = _state$current.vr,\n        noEvents = _state$current.noEvents,\n        invalidateFrameloop = _state$current.invalidateFrameloop,\n        frames = _state$current.frames,\n        subscribers = _state$current.subscribers,\n        captured = _state$current.captured,\n        initialClick = _state$current.initialClick,\n        initialHits = _state$current.initialHits,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadowmap\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var IsReady = React.useCallback(function () {\n    var activate = function activate() {\n      return setReady(true);\n    }; // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render(React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, React.createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        if (state.current.gl.dispose) state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useContext(context) {\n  var result = React.useContext(context);\n\n  if (!result) {\n    console.warn('hooks can only be used within the canvas! https://github.com/react-spring/react-three-fiber#hooks');\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  Object.keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = React.useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(function (url) {\n      return new Promise(function (res) {\n        return loader.load(url, function (data) {\n          var objects = [];\n          if (data.scene) data.scene.traverse(function (props) {\n            return objects.push(prune(props));\n          });\n          data.__$ = objects;\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  React.useEffect(function () {\n    return function () {\n      return results.forEach(function (data) {\n        if (data.dispose) data.dispose();\n        if (data.scene && data.scene.dispose) data.scene.dispose();\n      });\n    };\n  }, []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  var isArray = Array.isArray(url);\n\n  if (!isArray) {\n    var _Object$assign;\n\n    Object.assign(results[0], (_Object$assign = {}, _Object$assign[Symbol.iterator] = function () {\n      console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n      return [results[0]][Symbol.iterator]();\n    }, _Object$assign));\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\nfunction useCamera(camera, props) {\n  var _useThree = useThree(),\n      mouse = _useThree.mouse;\n\n  var _useState2 = React.useState(function () {\n    var raycaster = new THREE.Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    var originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }),\n      raycast = _useState2[0];\n\n  return raycast;\n}\n\nvar vector = new THREE.Vector3();\n\nfunction calculatePosition(el, camera, viewport) {\n  vector.setFromMatrixPosition(el.matrixWorld);\n  vector.project(camera);\n  return [(vector.x + 1) * viewport.width / 2, (-vector.y + 1) * viewport.height / 2];\n}\n\nvar Dom = React__default.forwardRef(function (_ref, ref) {\n  var children = _ref.children,\n      _ref$eps = _ref.eps,\n      eps = _ref$eps === void 0 ? 0.001 : _ref$eps,\n      style = _ref.style,\n      className = _ref.className,\n      prepend = _ref.prepend,\n      center = _ref.center,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"eps\", \"style\", \"className\", \"prepend\", \"center\"]);\n\n  var _useThree = useThree(),\n      gl = _useThree.gl,\n      scene = _useThree.scene,\n      camera = _useThree.camera,\n      viewport = _useThree.viewport;\n\n  var _useState = React.useState(function () {\n    return document.createElement('div');\n  }),\n      el = _useState[0];\n\n  var group = React.useRef(null);\n  var old = React.useRef([0, 0]);\n  React.useEffect(function () {\n    if (group.current) {\n      scene.updateMatrixWorld();\n      var vec = calculatePosition(group.current, camera, viewport);\n      el.style.cssText = \"position:absolute;top:0;left:0;transform:translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0);\";\n\n      if (gl.domElement.parentNode) {\n        if (prepend) gl.domElement.parentNode.prepend(el);else gl.domElement.parentNode.appendChild(el);\n      }\n\n      return function () {\n        if (gl.domElement.parentNode) gl.domElement.parentNode.removeChild(el);\n        ReactDOM.unmountComponentAtNode(el);\n      };\n    }\n  }, []);\n  React.useEffect(function () {\n    return void ReactDOM.render(React__default.createElement(\"div\", {\n      style: _extends({\n        transform: center ? 'translate3d(-50%,-50%,0)' : 'none'\n      }, style),\n      className: className,\n      ref: ref\n    }, children), el);\n  });\n  useFrame(function () {\n    if (group.current) {\n      var vec = calculatePosition(group.current, camera, viewport);\n\n      if (Math.abs(old.current[0] - vec[0]) > eps || Math.abs(old.current[1] - vec[1]) > eps) {\n        el.style.transform = \"translate3d(\" + vec[0] + \"px,\" + vec[1] + \"px,0)\";\n      }\n\n      old.current = vec;\n    }\n  });\n  return React__default.createElement(\"group\", _extends({}, props, {\n    ref: group\n  }));\n});\n\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  var children = _ref.children,\n      setEvents = _ref.setEvents,\n      container = _ref.container,\n      renderer = _ref.renderer,\n      effects = _ref.effects,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]);\n\n  // Create renderer\n  var _useState = React.useState(renderer),\n      gl = _useState[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount managemenbt\n\n  React.useEffect(function () {\n    return effects && effects(gl, container);\n  }, []); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_extends({}, props, {\n    children: children,\n    gl: gl\n  }));\n  React.useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n}\n\nvar ResizeContainer = React__default.memo(function (props) {\n  var renderer = props.renderer,\n      effects = props.effects,\n      children = props.children,\n      vr = props.vr,\n      gl2 = props.gl2,\n      concurrent = props.concurrent,\n      shadowMap = props.shadowMap,\n      orthographic = props.orthographic,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"renderer\", \"effects\", \"children\", \"vr\", \"gl2\", \"concurrent\", \"shadowMap\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  var containerRef = React.useRef();\n\n  var _useState2 = React.useState({}),\n      events = _useState2[0],\n      setEvents = _useState2[1];\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? resizeObserver.ResizeObserver : undefined\n  }),\n      bind = _useMeasure[0],\n      size = _useMeasure[1]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = React.useRef(false);\n  var ready = React.useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = React.useMemo(function () {\n    return {\n      size: size,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return React__default.createElement(\"div\", _extends({\n    style: _extends({}, defaultStyles, {}, style)\n  }, restSpread)); // Render the canvas into the dom\n\n  return React__default.createElement(\"div\", _extends({\n    ref: mergeRefs([bind, containerRef]),\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), preRender, ready && React__default.createElement(Content, _extends({}, props, state)));\n});\n\nvar Canvas = React__default.memo(function (_ref) {\n  var children = _ref.children,\n      props = _objectWithoutPropertiesLoose(_ref, [\"children\"]);\n\n  var canvasRef = React.useRef();\n  return React__default.createElement(ResizeContainer, _extends({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _extends({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new THREE.WebGLRenderer(_extends({\n          canvas: canvasRef.current,\n          context: props.gl2 ? canvasRef.current.getContext('webgl2', params) : undefined\n        }, params));\n        return temp;\n      }\n    },\n    preRender: React__default.createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nexports.Canvas = Canvas;\nexports.Dom = Dom;\nexports.Renderer = Renderer;\nexports.addEffect = addEffect;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCamera = useCamera;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useLoader = useLoader;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;\n"]},"metadata":{},"sourceType":"script"}