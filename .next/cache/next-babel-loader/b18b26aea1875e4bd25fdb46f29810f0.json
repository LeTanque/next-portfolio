{"ast":null,"code":"'use strict';\n\nvar _Symbol$iterator = require(\"@babel/runtime-corejs2/core-js/symbol/iterator\");\n\nvar _Promise = require(\"@babel/runtime-corejs2/core-js/promise\");\n\nvar _Object$assign2 = require(\"@babel/runtime-corejs2/core-js/object/assign\");\n\nvar _Array$from = require(\"@babel/runtime-corejs2/core-js/array/from\");\n\nvar _getIterator = require(\"@babel/runtime-corejs2/core-js/get-iterator\");\n\nvar _Set = require(\"@babel/runtime-corejs2/core-js/set\");\n\nvar _Symbol$for = require(\"@babel/runtime-corejs2/core-js/symbol/for\");\n\nvar _Symbol = require(\"@babel/runtime-corejs2/core-js/symbol\");\n\nvar _Object$entries = require(\"@babel/runtime-corejs2/core-js/object/entries\");\n\nvar _Object$keys = require(\"@babel/runtime-corejs2/core-js/object/keys\");\n\nvar _Array$isArray = require(\"@babel/runtime-corejs2/core-js/array/is-array\");\n\nvar _Map = require(\"@babel/runtime-corejs2/core-js/map\");\n\nvar _Symbol$toPrimitive = require(\"@babel/runtime-corejs2/core-js/symbol/to-primitive\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\n_Object$defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar _construct = _interopDefault(require('@babel/runtime/helpers/construct'));\n\nvar _objectWithoutPropertiesLoose = _interopDefault(require('@babel/runtime/helpers/objectWithoutPropertiesLoose'));\n\nvar _extends = _interopDefault(require('@babel/runtime/helpers/extends'));\n\nvar THREE = require('three');\n\nvar Reconciler = _interopDefault(require('react-reconciler'));\n\nvar scheduler = require('scheduler');\n\nvar React = require('react');\n\nvar tinyEmitter = require('tiny-emitter');\n\nvar usePromise = _interopDefault(require('react-promise-suspense'));\n\nvar useMeasure = _interopDefault(require('react-use-measure'));\n\nvar resizeObserver = require('@juggle/resize-observer');\n\nvar version = \"3.0.17\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[_Symbol$toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nvar roots = new _Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a);\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return _Array$isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\nvar globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  } // Run global effects\n\n\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, {}, objects));\n};\n\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  } // Filter equals, events and reserved props\n\n\n  var container = instance.__container;\n\n  var sameProps = _Object$keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n\n  var handlers = _Object$keys(newProps).filter(function (key) {\n    return typeof newProps[key] === 'function' && key.startsWith('on');\n  });\n\n  var leftOvers = accumulative ? _Object$keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var filteredProps = [].concat(sameProps, ['children', 'key', 'ref']).reduce(function (acc, prop) {\n    var _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return filteredProps[key] = undefined;\n  });\n\n  if (_Object$keys(filteredProps).length > 0) {\n    _Object$entries(filteredProps).forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          var _target;\n\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (_Array$isArray(value)) (_target = target).set.apply(_target, value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        var _extends2;\n\n        return _extends({}, acc, (_extends2 = {}, _extends2[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key], _extends2));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? _construct(target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [].concat(parentInstance.children.slice(0, index), [child], parentInstance.children.slice(index));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n        return x !== child;\n      }); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? _Object$entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots[\"delete\"](container);\n  });\n}\n\nvar hasSymbol = typeof _Symbol === 'function' && _Symbol$for;\nvar REACT_PORTAL_TYPE = hasSymbol ? _Symbol$for('react.portal') : 0xeaca;\n\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: false ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = React.createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = React.useState(false),\n      ready = _useState[0],\n      setReady = _useState[1];\n\n  var _useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _useState2[0];\n\n  var _useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _useState3[0];\n\n  var _useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _useState4[0];\n\n  var _useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n      defaultCam = _useState5[0],\n      _setDefaultCamera = _useState5[1];\n\n  var _useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr: vr,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      } // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n\n\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event) {\n      return handlePointerMove(event || {});\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new THREE.Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = THREE.Math.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (_ref) {\n    var clientX = _ref.clientX,\n        clientY = _ref.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    } // Skip event handling when noEvents is set\n\n\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    var seen = new _Set();\n    var hits = []; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (var _iterator = intersects, _isArray = _Array$isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _getIterator(_iterator);;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var _intersect = _ref2;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = React.useMemo(function () {\n    return new _Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (event, fn) {\n    prepareRay(event); // Get fresh intersects\n\n    var hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!hits.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      var unprojectedPoint = new THREE.Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      var _delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      var _loop = function _loop() {\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) return \"break\";\n          _ref3 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) return \"break\";\n          _ref3 = _i2.value;\n        }\n\n        var hit = _ref3;\n        var stopped = {\n          current: false\n        };\n\n        var raycastEvent = _extends({}, event, {}, hit, {\n          stopped: stopped,\n          delta: _delta,\n          unprojectedPoint: unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: function stopPropagation() {\n            return stopped.current = true;\n          },\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (stopped.current === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && _Array$from(hovered.values()).find(function (i) {\n            return i.object === hit.object;\n          })) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          return \"break\";\n        }\n      };\n\n      for (var _iterator2 = hits, _isArray2 = _Array$isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _getIterator(_iterator2);;) {\n        var _ref3;\n\n        var _ret = _loop();\n\n        if (_ret === \"break\") break;\n      }\n    }\n\n    return hits;\n  }, []);\n  var handlePointerMove = React.useCallback(function (event) {\n    state.current.pointer.emit('pointerMove', event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits) {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n\n    _Array$from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered[\"delete\"](makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event) {\n      state.current.pointer.emit(name, event); // Collect hits\n\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click,\n          // which must must the initial target\n          if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if (name === 'click' && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: function onGotPointerCapture(e) {\n        return state.current.captured = intersect(e, false);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef();\n  React.useMemo(function () {\n    var _state$current = state.current,\n        ready = _state$current.ready,\n        manual = _state$current.manual,\n        vr = _state$current.vr,\n        noEvents = _state$current.noEvents,\n        invalidateFrameloop = _state$current.invalidateFrameloop,\n        frames = _state$current.frames,\n        subscribers = _state$current.subscribers,\n        captured = _state$current.captured,\n        initialClick = _state$current.initialClick,\n        initialHits = _state$current.initialHits,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadowmap\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') _Object$assign2(gl, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var IsReady = React.useCallback(function () {\n    var activate = function activate() {\n      return setReady(true);\n    };\n\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render(React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, React.createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        state.current.gl.forceContextLoss();\n        state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = React.useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n}\n\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\n\nfunction useThree() {\n  return React.useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = React.useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\n\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  _Object$keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = React.useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = _Array$isArray(url) ? url : [url];\n    return _Promise.all(urlArray.map(function (url) {\n      return new _Promise(function (res) {\n        return loader.load(url, function (data) {\n          if (data.scene) {\n            var objects = [];\n            data.scene.traverse(function (props) {\n              return objects.push(prune(props));\n            });\n            data.__$ = objects;\n          }\n\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  React.useEffect(function () {\n    return function () {\n      return results.forEach(function (data) {\n        if (data.dispose) data.dispose();\n        if (data.scene && data.scene.dispose) data.scene.dispose();\n      });\n    };\n  }, []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  var isArray = _Array$isArray(url);\n\n  if (!isArray) {\n    var _Object$assign;\n\n    _Object$assign2(results[0], (_Object$assign = {}, _Object$assign[_Symbol$iterator] = function () {\n      console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n      return _getIterator([results[0]]);\n    }, _Object$assign));\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\n\nfunction useCamera(camera, props) {\n  var _useThree = useThree(),\n      mouse = _useThree.mouse;\n\n  var raycast = React.useMemo(function () {\n    var raycaster = new THREE.Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    var originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }, []);\n  return raycast;\n}\n\nvar IsReady = React.memo(function (_ref) {\n  var setEvents = _ref.setEvents,\n      canvas = _ref.canvas,\n      gl2 = _ref.gl2,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\", \"gl2\"]);\n\n  var params = _extends({\n    antialias: true,\n    alpha: true\n  }, props.gl);\n\n  var gl = React.useMemo(function () {\n    return new THREE.WebGLRenderer(_extends({\n      canvas: canvas,\n      context: gl2 ? canvas.getContext('webgl2', params) : undefined\n    }, params));\n  }, []); // Init canvas, fetch events, hand them back to the warpping div\n\n  var events = useCanvas(_extends({}, props, {\n    gl: gl\n  }));\n  React.useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n});\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nvar Canvas = React.memo(function (props) {\n  var children = props.children,\n      vr = props.vr,\n      gl2 = props.gl2,\n      shadowMap = props.shadowMap,\n      orthographic = props.orthographic,\n      resize = props.resize,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      style = props.style,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"gl2\", \"shadowMap\", \"orthographic\", \"resize\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  var canvasRef = React.useRef();\n\n  var _useState = React.useState({}),\n      events = _useState[0],\n      setEvents = _useState[1];\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: true || !window.ResizeObserver ? resizeObserver.ResizeObserver : undefined\n  }),\n      bind = _useMeasure[0],\n      size = _useMeasure[1]; // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n\n  if (true) {\n    return React.createElement(\"div\", {\n      style: _extends({}, defaultStyles, {}, style)\n    }, React.createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return React.createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && React.createElement(IsReady, _extends({}, props, {\n    size: size,\n    gl2: gl2,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\nexports.Canvas = Canvas;\nexports.Renderer = Renderer;\nexports.addEffect = addEffect;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCamera = useCamera;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useLoader = useLoader;\nexports.useRender = useRender;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;","map":{"version":3,"sources":["/Users/tank/git/Portfolio/next-portfolio/node_modules/react-three-fiber/web.cjs.js"],"names":["exports","value","_interopDefault","ex","_construct","require","_objectWithoutPropertiesLoose","_extends","THREE","Reconciler","scheduler","React","tinyEmitter","usePromise","useMeasure","resizeObserver","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","undefined","res","call","TypeError","Number","roots","emptyObject","is","obj","a","Object","str","num","und","arr","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","delta","current","clock","getDelta","subscribers","sub","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","filter","handlers","startsWith","leftOvers","filteredProps","concat","reduce","acc","prop","_","rest","map","length","_ref","includes","target","entries","split","set","_entries$reverse","reverse","_name","reverseEntries","slice","copy","Layers","_target","constructor","name","apply","invalidateInstance","raycast","__handlers","index","__interaction","indexOf","splice","_extends2","charAt","toLowerCase","substr","parent","updateInstance","update","createInstance","type","_ref2","hostContext","internalInstanceHandle","_ref2$args","args","props","toUpperCase","object","__instance","has","fn","node","stateNode","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","children","removeRecursive","array","clone","removeChild","remove","x","unstable_runWithPriority","unstable_IdlePriority","dispose","switchInstance","fiber","newInstance","alternate","Renderer","now","unstable_now","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","hasNewArgs","some","_ref3","val","hideInstance","visible","unhideInstance","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","element","get","newRoot","createContainer","updateContainer","getPublicRootInstance","unmountComponentAtNode","hasSymbol","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","createContext","useCanvas","orthographic","raycaster","size","pixelRatio","_props$vr","_props$shadowMap","shadowMap","_props$invalidateFram","_props$updateDefaultC","updateDefaultCamera","_props$noEvents","noEvents","onCreated","onPointerMissed","_useState","useState","setReady","_useState2","Vector2","mouse","_useState3","ray","Raycaster","raycasterProps","defaultRaycaster","_useState4","Scene","defaultScene","_useState5","cam","OrthographicCamera","PerspectiveCamera","position","z","defaultCam","_setDefaultCamera","_useState6","Clock","useRef","aspect","viewport","width","height","factor","initialClick","initialHits","pointer","TinyEmitter","captured","events","subscribe","priority","sort","s","setDefaultCamera","invalidate$1","intersect","handlePointerMove","useMemo","Vector3","distance","distanceTo","fov","degToRad","tan","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","prepareRay","useCallback","clientX","clientY","_state$current$size","setFromCamera","prepare","seen","hits","intersects","intersectObjects","item","id","sharedState","_iterator","_isArray","_i","next","done","_intersect","calculateDistance","dx","dy","round","sqrt","hovered","handleIntersects","find","hit","unprojectedPoint","y","unproject","_delta","_loop","_isArray2","_i2","_iterator2","stopped","raycastEvent","stopPropagation","sourceEvent","values","handlePointerCancel","_ret","emit","data","pointerMove","pointerOver","pointerEnter","pointerOut","pointerLeave","hoveredItem","handlePointer","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","e","onPointerMove","onGotPointerCapture","onLostPointerCapture","_state$current","useLayoutEffect","setPixelRatio","enabled","PCFSoftShadowMap","IsReady","activate","useEffect","result","then","createElement","Provider","setAnimationLoop","t","console","warn","forceContextLoss","useFrame","renderPriority","_useContext","useContext","unsubscribe","useRender","takeOver","useThree","useUpdate","dependents","optionalRef","_useContext2","localRef","useResource","forceUpdate","blackList","prune","reducedProps","material","geometry","useLoader","Proto","url","extensions","loader","temp","results","urlArray","all","load","traverse","__$","isArray","_Object$assign","useCamera","_useThree","originalRaycast","prototype","bind","memo","setEvents","canvas","gl2","params","antialias","alpha","WebGLRenderer","context","getContext","defaultStyles","overflow","Canvas","resize","style","restSpread","canvasRef","_useMeasure","scroll","debounce","polyfill","window","ResizeObserver","display"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nfunction _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }\n\nvar _construct = _interopDefault(require('@babel/runtime/helpers/construct'));\nvar _objectWithoutPropertiesLoose = _interopDefault(require('@babel/runtime/helpers/objectWithoutPropertiesLoose'));\nvar _extends = _interopDefault(require('@babel/runtime/helpers/extends'));\nvar THREE = require('three');\nvar Reconciler = _interopDefault(require('react-reconciler'));\nvar scheduler = require('scheduler');\nvar React = require('react');\nvar tinyEmitter = require('tiny-emitter');\nvar usePromise = _interopDefault(require('react-promise-suspense'));\nvar useMeasure = _interopDefault(require('react-use-measure'));\nvar resizeObserver = require('@juggle/resize-observer');\n\nvar version = \"3.0.17\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a);\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\nvar globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  }); // Run local effects\n\n  var delta = state.current.clock.getDelta();\n  state.current.subscribers.forEach(function (sub) {\n    return sub.ref.current(state.current, delta);\n  }); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0; // Run global effects\n\n  globalEffects.forEach(function (effect) {\n    return effect(timestamp) && repeat++;\n  });\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(function (root) {\n    return root.containerInfo.__state.current.frames = frames;\n  });else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nvar catalogue = {};\nvar extend = function extend(objects) {\n  return void (catalogue = _extends({}, catalogue, {}, objects));\n};\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  }\n\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n  var sameProps = Object.keys(newProps).filter(function (key) {\n    return is.equ(newProps[key], oldProps[key]);\n  });\n  var handlers = Object.keys(newProps).filter(function (key) {\n    return typeof newProps[key] === 'function' && key.startsWith('on');\n  });\n  var leftOvers = accumulative ? Object.keys(oldProps).filter(function (key) {\n    return newProps[key] === void 0;\n  }) : [];\n  var filteredProps = [].concat(sameProps, ['children', 'key', 'ref']).reduce(function (acc, prop) {\n    var _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(function (key) {\n    return filteredProps[key] = undefined;\n  });\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          var _target;\n\n          if (target.copy && target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) (_target = target).set.apply(_target, value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        var _extends2;\n\n        return _extends({}, acc, (_extends2 = {}, _extends2[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key], _extends2));\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else if (type === 'new') {\n    instance = new props.object(args);\n  } else {\n    var target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? _construct(target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [].concat(parentInstance.children.slice(0, index), [child], parentInstance.children.slice(index));\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n        return x !== child;\n      });else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n        return x !== child;\n      }); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  scheduleTimeout: typeof setTimeout === 'function' ? setTimeout : undefined,\n  cancelTimeout: typeof clearTimeout === 'function' ? clearTimeout : undefined,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren() {\n    return false;\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {},\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  }\n});\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    var newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  var root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, function () {\n    return void roots[\"delete\"](container);\n  });\n}\nvar hasSymbol = typeof Symbol === 'function' && Symbol[\"for\"];\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol[\"for\"]('react.portal') : 0xeaca;\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = React.createContext({});\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed; // Local, reactive state\n\n  var _useState = React.useState(false),\n      ready = _useState[0],\n      setReady = _useState[1];\n\n  var _useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _useState2[0];\n\n  var _useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          raycasterProps = _objectWithoutPropertiesLoose(raycaster, [\"filter\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _useState3[0];\n\n  var _useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _useState4[0];\n\n  var _useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n      defaultCam = _useState5[0],\n      _setDefaultCamera = _useState5[1];\n\n  var _useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    vr: vr,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      }\n\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        // Decrease manual flag if this subscription had a priority\n        if (priority) state.current.manual--;\n        state.current.subscribers = state.current.subscribers.filter(function (s) {\n          return s.ref !== ref;\n        });\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event) {\n      return handlePointerMove(event || {});\n    }\n  }); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.noEvents = noEvents;\n  }, [invalidateFrameloop, vr, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height;\n\n    if (isOrthographicCamera(defaultCam)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      var target = new THREE.Vector3(0, 0, 0);\n      var distance = defaultCam.position.distanceTo(target);\n      var fov = THREE.Math.degToRad(defaultCam.fov); // convert vertical fov to radians\n\n      var height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var width = height * state.current.aspect;\n      state.current.viewport = {\n        width: width,\n        height: height,\n        factor: size.width / width\n      };\n    } // #92 (https://github.com/drcmda/react-three-fiber/issues/92)\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // #178: https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state);\n  }, [defaultCam, size, updateDefaultCamera]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (_ref) {\n    var clientX = _ref.clientX,\n        clientY = _ref.clientY;\n\n    if (clientX !== void 0) {\n      var _state$current$size = state.current.size,\n          left = _state$current$size.left,\n          right = _state$current$size.right,\n          top = _state$current$size.top,\n          bottom = _state$current$size.bottom;\n      mouse.set((clientX - left) / (right - left) * 2 - 1, -((clientY - top) / (bottom - top)) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    if (prepare) prepareRay(event);\n    var seen = new Set();\n    var hits = []; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // #16031: (https://github.com/mrdoob/three.js/issues/16031)\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) intersects = raycaster.filter(intersects, sharedState.current);\n\n    for (var _iterator = intersects, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var _intersect = _ref2;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.clientX - state.current.initialClick[0];\n    var dy = event.clientY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var hovered = React.useMemo(function () {\n    return new Map();\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (event, fn) {\n    prepareRay(event); // Get fresh intersects\n\n    var hits = intersect(event, false); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!hits.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) hits.push(captured);\n      });\n    } // If anything has been found, forward it to the event listeners\n\n\n    if (hits.length) {\n      var unprojectedPoint = new THREE.Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      var _delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n      var _loop = function _loop() {\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) return \"break\";\n          _ref3 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) return \"break\";\n          _ref3 = _i2.value;\n        }\n\n        var hit = _ref3;\n        var stopped = {\n          current: false\n        };\n\n        var raycastEvent = _extends({}, event, {}, hit, {\n          stopped: stopped,\n          delta: _delta,\n          unprojectedPoint: unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          camera: state.current.camera,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: function stopPropagation() {\n            return stopped.current = true;\n          },\n          sourceEvent: event\n        });\n\n        fn(raycastEvent);\n\n        if (stopped.current === true) {\n          // Propagation is stopped, remove all other hover records\n          // An event handler is only allowed to flush other handlers if it is hovered itself\n          if (hovered.size && Array.from(hovered.values()).find(function (i) {\n            return i.object === hit.object;\n          })) {\n            handlePointerCancel(raycastEvent, [hit]);\n          }\n\n          return \"break\";\n        }\n      };\n\n      for (var _iterator2 = hits, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n        var _ref3;\n\n        var _ret = _loop();\n\n        if (_ret === \"break\") break;\n      }\n    }\n\n    return hits;\n  }, []);\n  var handlePointerMove = React.useCallback(function (event) {\n    state.current.pointer.emit('pointerMove', event);\n    var hits = handleIntersects(event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends({}, data, {\n            type: 'pointerEnter'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits) {\n    state.current.pointer.emit('pointerCancel', event);\n    if (!hits) hits = handleIntersects(event, function () {\n      return null;\n    });\n    Array.from(hovered.values()).forEach(function (data) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (i) {\n        return i.eventObject === data.eventObject;\n      }))) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers) {\n          if (handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n\n        hovered[\"delete\"](makeId(data));\n      }\n    });\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event) {\n      state.current.pointer.emit(name, event); // Collect hits\n\n      var hits = handleIntersects(event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click,\n          // which must must the initial target\n          if (name !== 'click' || state.current.initialHits.includes(eventObject)) handlers[name](data);\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.clientX, event.clientY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if (name === 'click' && !hits.length && onPointerMissed) {\n        if (calculateDistance(event) <= 2) onPointerMissed();\n      }\n    };\n  }, [onPointerMissed]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      onGotPointerCapture: function onGotPointerCapture(e) {\n        return state.current.captured = intersect(e, false);\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [onPointerMissed]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef();\n  React.useMemo(function () {\n    var _state$current = state.current,\n        ready = _state$current.ready,\n        manual = _state$current.manual,\n        vr = _state$current.vr,\n        noEvents = _state$current.noEvents,\n        invalidateFrameloop = _state$current.invalidateFrameloop,\n        frames = _state$current.frames,\n        subscribers = _state$current.subscribers,\n        captured = _state$current.captured,\n        initialClick = _state$current.initialClick,\n        initialHits = _state$current.initialHits,\n        props = _objectWithoutPropertiesLoose(_state$current, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props;\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    return void (pixelRatio && gl.setPixelRatio(pixelRatio));\n  }, [pixelRatio]); // Update shadowmap\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n  }, [shadowMap]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var IsReady = React.useCallback(function () {\n    var activate = function activate() {\n      return setReady(true);\n    };\n\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      return void (result && result.then ? result.then(activate) : activate());\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render(React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children, React.createElement(IsReady, null)), defaultScene, state);\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        invalidate(state);\n      } else if (gl.vr && gl.setAnimationLoop) {\n        gl.vr.enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else console.warn('the gl instance does not support VR!');\n    }\n  }, [ready]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        state.current.gl.forceContextLoss();\n        state.current.gl.dispose();\n        state.current.gl = undefined;\n        unmountComponentAtNode(state.current.scene);\n        state.current.active = false;\n      }\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = React.useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority]);\n}\nfunction useRender(callback, takeOver) {\n  return useFrame(callback, takeOver ? 1 : 0);\n}\nfunction useThree() {\n  return React.useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = React.useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, [ref.current]);\n  return [ref, ref.current];\n}\nvar blackList = ['id', 'uuid', 'type', 'children', 'parent', 'matrix', 'matrixWorld', 'matrixWorldNeedsUpdate', 'modelViewMatrix', 'normalMatrix'];\n\nfunction prune(props) {\n  var reducedProps = _extends({}, props); // Remove black listed props\n\n\n  blackList.forEach(function (name) {\n    return delete reducedProps[name];\n  }); // Remove functions\n\n  Object.keys(reducedProps).forEach(function (name) {\n    return typeof reducedProps[name] === 'function' && delete reducedProps[name];\n  }); // Prune materials and geometries\n\n  if (reducedProps.material) reducedProps.material = prune(reducedProps.material);\n  if (reducedProps.geometry) reducedProps.geometry = prune(reducedProps.geometry); // Return cleansed object\n\n  return reducedProps;\n}\n\nfunction useLoader(Proto, url, extensions) {\n  var loader = React.useMemo(function () {\n    // Construct new loader\n    var temp = new Proto(); // Run loader extensions\n\n    if (extensions) extensions(temp);\n    return temp;\n  }, [Proto]); // Use suspense to load async assets\n\n  var results = usePromise(function (Proto, url) {\n    var urlArray = Array.isArray(url) ? url : [url];\n    return Promise.all(urlArray.map(function (url) {\n      return new Promise(function (res) {\n        return loader.load(url, function (data) {\n          if (data.scene) {\n            var objects = [];\n            data.scene.traverse(function (props) {\n              return objects.push(prune(props));\n            });\n            data.__$ = objects;\n          }\n\n          res(data);\n        });\n      });\n    }));\n  }, [Proto, url]); // Dispose objects on unmount\n\n  React.useEffect(function () {\n    return function () {\n      return results.forEach(function (data) {\n        if (data.dispose) data.dispose();\n        if (data.scene && data.scene.dispose) data.scene.dispose();\n      });\n    };\n  }, []); // Temporary hack to make the new api backwards compatible for a while ...\n\n  var isArray = Array.isArray(url);\n\n  if (!isArray) {\n    var _Object$assign;\n\n    Object.assign(results[0], (_Object$assign = {}, _Object$assign[Symbol.iterator] = function () {\n      console.warn('[value]=useLoader(...) is deprecated, please use value=useLoader(...) instead!');\n      return [results[0]][Symbol.iterator]();\n    }, _Object$assign));\n  } // Return the object itself and a list of pruned props\n\n\n  return isArray ? results : results[0];\n}\nfunction useCamera(camera, props) {\n  var _useThree = useThree(),\n      mouse = _useThree.mouse;\n\n  var raycast = React.useMemo(function () {\n    var raycaster = new THREE.Raycaster();\n    if (props) applyProps(raycaster, props, {});\n    var originalRaycast = undefined;\n    return function (_, intersects) {\n      raycaster.setFromCamera(mouse, camera);\n      if (!originalRaycast) originalRaycast = this.constructor.prototype.raycast.bind(this);\n      if (originalRaycast) originalRaycast(raycaster, intersects);\n    };\n  }, []);\n  return raycast;\n}\n\nvar IsReady = React.memo(function (_ref) {\n  var setEvents = _ref.setEvents,\n      canvas = _ref.canvas,\n      gl2 = _ref.gl2,\n      props = _objectWithoutPropertiesLoose(_ref, [\"setEvents\", \"canvas\", \"gl2\"]);\n\n  var params = _extends({\n    antialias: true,\n    alpha: true\n  }, props.gl);\n\n  var gl = React.useMemo(function () {\n    return new THREE.WebGLRenderer(_extends({\n      canvas: canvas,\n      context: gl2 ? canvas.getContext('webgl2', params) : undefined\n    }, params));\n  }, []); // Init canvas, fetch events, hand them back to the warpping div\n\n  var events = useCanvas(_extends({}, props, {\n    gl: gl\n  }));\n  React.useEffect(function () {\n    return void setEvents(events);\n  }, [events]);\n  return null;\n});\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\nvar Canvas = React.memo(function (props) {\n  var children = props.children,\n      vr = props.vr,\n      gl2 = props.gl2,\n      shadowMap = props.shadowMap,\n      orthographic = props.orthographic,\n      resize = props.resize,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      style = props.style,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      restSpread = _objectWithoutPropertiesLoose(props, [\"children\", \"vr\", \"gl2\", \"shadowMap\", \"orthographic\", \"resize\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"style\", \"onCreated\", \"onPointerMissed\"]);\n\n  var canvasRef = React.useRef();\n\n  var _useState = React.useState({}),\n      events = _useState[0],\n      setEvents = _useState[1];\n\n  var _useMeasure = useMeasure(resize || {\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    },\n    polyfill: typeof window === 'undefined' || !window.ResizeObserver ? resizeObserver.ResizeObserver : undefined\n  }),\n      bind = _useMeasure[0],\n      size = _useMeasure[1]; // Allow Gatsby, Next and other server side apps to run.\n  // Will output styles to reduce flickering.\n\n\n  if (typeof window === 'undefined') {\n    return React.createElement(\"div\", {\n      style: _extends({}, defaultStyles, {}, style)\n    }, React.createElement(\"canvas\", {\n      style: {\n        display: 'block'\n      }\n    }));\n  } // Render the canvas into the dom\n\n\n  return React.createElement(\"div\", _extends({\n    ref: bind,\n    style: _extends({}, defaultStyles, {}, style)\n  }, events, restSpread), React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'block'\n    }\n  }), canvasRef.current && React.createElement(IsReady, _extends({}, props, {\n    size: size,\n    gl2: gl2,\n    canvas: canvasRef.current,\n    setEvents: setEvents\n  })));\n});\n\nexports.Canvas = Canvas;\nexports.Renderer = Renderer;\nexports.addEffect = addEffect;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCamera = useCamera;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useLoader = useLoader;\nexports.useRender = useRender;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;\n"]},"metadata":{},"sourceType":"script"}